/*******************************************************************************
	GLUE-Math Library: log-factorial (long double)

	Author: Hironobu Inatsuka aka tribusonz
	License: GPL + X11(MIT)
	Reference:
		John D. Cook Consulting
*******************************************************************************/
#ifndef GML_LOGFACTRIAL_LDBL_INTERNAL
#define GML_LOGFACTRIAL_LDBL_INTERNAL

#if defined(__cplusplus)
extern "C" {
#endif

// uses math library: logl()
#include "../../sys/float/huge_val_nan.h"
#include "logl.h"
#include "m_pi.h"

static inline long double
logfactoriall_core(register int n)
{
	static long double pi = 0.L;
	static const long double lf[] =
	{
		0.0,
		0.0,
		0.693147180559945309417232121458177e0,
		0.1791759469228055000812477358380702e1,
		0.3178053830347945619646941601297055e1,
		0.4787491742782045994247700934523243e1,
		0.6579251212010100995060178292903945e1,
		0.8525161361065414300165531036347125e1,
		0.10604602902745250228417227400721655e2,
		0.12801827480081469611207717874566706e2,
		0.1510441257307551529522570932925107e2,
		0.175023078458738858392876529072162e2,
		0.19987214495661886149517362387055079e2,
		0.22552163853123422885570849828620397e2,
		0.25191221182738681500093434693521753e2,
		0.27899271383840891566089439263670467e2,
		0.30671860106080672803758367749503173e2,
		0.335050734501368888840079023673763e2,
		0.36395445208033053576215624962679528e2,
		0.39339884187199494036224652394567381e2,
		0.42335616460753485029659875970709922e2,
		0.45380138898476908026160473951075627e2,
		0.48471181351835223879639649650498933e2,
		0.51606675567764373570446402482309129e2,
		0.54784729398112319190093344083606185e2,
		0.5800360522298051993929486275005856e2,
		0.61261701761002001984765582313082055e2,
		0.64557538627006331058951318023849632e2,
		0.67889743137181534982891135010209165e2,
		0.71257038967168009010074407042571077e2,
		0.74658236348830164385487643734177967e2,
		0.78092223553315310631416808058720324e2,
		0.81557959456115037178502968666011207e2,
		0.85054467017581517413960157480898862e2,
		0.88580827542197678803626924220230165e2,
		0.92136175603687092483333036296899532e2,
		0.95719694542143202484957991013660937e2,
		0.99330612454787426929326086684692384e2,
		0.102968198614513812698752346238038414e3,
		0.106631760260643459126201078916526258e3,
		0.110320639714757395429053534614126976e3,
		0.114034211781461703232920297987164383e3,
		0.117771881399745071538838128088988265e3,
		0.121533081515438633962310970602334112e3,
		0.125317271149356895125207378423215595e3,
		0.129123933639127214882598628230286834e3,
		0.132952575035616309882822613183555206e3,
		0.13680272263732636846964356385332738e3,
		0.140673923648234259398707737576082612e3,
		0.144565743946344886008918443062968972e3,
		0.148477766951773032067537193850879523e3,
		0.152409592584497357839181973705675176e3,
		0.156360836303078785194069925390156847e3,
		0.160331128216630907028214394529185905e3,
		0.164320112263195181411817362361411659e3,
		0.168327445448427652330480065272602976e3,
		0.172352797139162801563837114380420685e3,
		0.176395848406997351715241387049231064e3,
		0.180456291417543771051841891203051153e3,
		0.18453382886144949050245794157677085e3,
		0.188628173423671591187288410389835917e3,
		0.192739047287844902436039799493261531e3,
		0.196866181672889993991386195939262065e3,
		0.201009316399281526679282039156550296e3,
		0.205168199482641198535785431885299356e3,
		0.209342586752536835646439678660090862e3,
		0.213532241494563261191314099596436694e3,
		0.217736934113954227250984171592800416e3,
		0.221956441819130333950068170453589896e3,
		0.226190548323727593332270168522322618e3,
		0.230439043565776952321393512720450162e3,
		0.234701723442818267742722967252963196e3,
		0.238978389561834323053765154091182777e3,
		0.24326884900298271418285726294862132e3,
		0.247572914096186883936642590741110943e3,
		0.251890402209723194377239354644485844e3,
		0.256221135550009525456082846319290051e3,
		0.26056494097186320930525014264069836e3,
		0.264921649798552801042116107440644381e3,
		0.269291097651019822536289052982125792e3,
		0.273673124285693704148558740801184686e3,
		0.278067573440366142914139721748874789e3,
		0.282474292687630396027423717243370373e3,
		0.286893133295426993950899189466661743e3,
		0.291323950094270307566234251689943802e3,
		0.295766601350760624021084545641043116e3,
		0.30022094864701413175397462027584714e3,
		0.304686856765668715472553137545131577e3,
		0.309164193580146921944866777487471236e3,
		0.313652829949879061783184593028141085e3,
		0.318152639620209326849993074956670501e3,
		0.322663499126726176891151915141678999e3,
		0.327185287703775217200793132216405548e3,
		0.331717887196928473138117541777870431e3,
		0.336261181979198477034355724569100781e3,
		0.340815058870799017868965511334214823e3,
		0.345379407062266854107446917178428231e3,
		0.349954118040770236929563638800132193e3,
		0.354539085519440808849191576408476729e3,
		0.35913420536957539877604401046028691e3,
		0.363739375555563490144079993369655638e3,
		0.368354496072404749594964191636568627e3,
		0.372979468885689020676026203612822456e3,
		0.377614197873918656446794805927875897e3,
		0.382258588773060029111099989733815745e3,
		0.386912549123217552482201347047407638e3,
		0.391575988217329619625763048307894873e3,
		0.39624881705179152579906744712491815e3,
		0.40093094827891574549208764707860208e3,
		0.405622296161144889192464963530811281e3,
		0.410322776526937305420544898563460775e3,
		0.415032306728249639556308239471414748e3,
		0.419750805599544734099082520700690634e3,
		0.424478193418257074667664652194306655e3,
		0.429214391866651570128486156984575211e3,
		0.433959323995014820193893669149611595e3,
		0.43871291418612118483991140542488986e3,
		0.44347508812091894095875538334030023e3,
		0.448245772745384605718788665835478104e3,
		0.45302489623849613510414355319679441e3,
		0.457812387981278181098391254131317653e3,
		0.462608178526874922186515141287247912e3,
		0.467412199571608178744683762512131703e3,
		0.472224383926980596239945771122091637e3,
		0.477044665492585633104709399689550347e3,
		0.48187297922988793422851167768922891e3,
		0.486709261136839412225824753027975317e3,
		0.49155344822329800349887219383569161e3,
		0.496405478487217620664792818685898846e3,
		0.501265290891579292779660906436167219e3,
		0.506132825342034875199732385332416901e3,
		0.511008022665236026743881809343586427e3,
		0.515890824587822397598173462401390435e3,
		0.520781173716044151363287842576721469e3,
		0.525679013515995062732375146694543368e3,
		0.530584288294433492181161641738537133e3,
		0.535496943180169544189662872720784789e3,
		0.540416924105997669104978062848764654e3,
		0.545344177791154873796597293038955553e3,
		0.550278651724285565553786077957831097e3,
		0.555220294146894869852326654277416817e3,
		0.560169054037273038130542850184111517e3,
		0.565124881094874298861289536838082727e3,
		0.570087725725134206141404967857613175e3,
		0.575057539024710206761864386817290933e3,
		0.580034272767130781163648418182879032e3,
		0.585017879388839117602157759161775751e3,
		0.590008311975617853903763709885584636e3,
		0.595005524249381968966966269799532437e3,
		0.600009470555327428107958698074636557e3,
		0.605020105849423683857972694099469635e3,
		0.610037385686238608186768930398954111e3,
		0.615061266207084884575029654195216494e3,
		0.620091704128477320038069679286934672e3,
		0.625128656730890949196654207729801158e3,
		0.630172081847810195817184131387569703e3,
		0.6352219378550597328634673283089739e3,
		0.640278183660408040920891773545377375e3,
		0.645340778693435007724481951208316963e3,
		0.650409682895655239250021665584268546e3,
		0.655484856710889066171708585524785617e3,
		0.660566261075873529167620691100038993e3,
		0.665653857411105913242618904169187272e3,
		0.670747607611912675576683836535308022e3,
		0.675847474039736873999385064151261783e3,
		0.680953419513637454609443012299375625e3,
		0.686065407301993997842335716644125172e3,
		0.691183401114410752949595467420869952e3,
		0.696307365093814011874347761765610187e3,
		0.701437263808737085346454736648740824e3,
		0.706573062245787347110722262721298315e3,
		0.71171472580229000695352178062703122e3,
		0.71686222027910345999582908738329342e3,
		0.722015511873601238942762587771734411e3,
		0.727174567172815767970758337162477025e3,
		0.73233935314673928202506520857237258e3,
		0.737509837141777433806796080636170416e3,
		0.742685986874351262948807376246812639e3,
		0.747867770424643348096542423908940665e3,
		0.753055156230484103092720228338962067e3,
		0.758248113081374313468945942388949659e3,
		0.763446610112640139215785029427582668e3,
		0.768650616799716934566361101734049343e3,
		0.773860102952558355506507736074397483e3,
		0.779075038710167341125566185270582209e3,
		0.784295394535245665944535040274839844e3,
		0.789521141208958867191276681957762904e3,
		0.794752249825813453815588160153601159e3,
		0.799988691788643403021243575066289686e3,
		0.805230438803703045400534663520500443e3,
		0.810477462875863531544561682407072661e3,
		0.815729736303910161417411632359275028e3,
		0.820987231675937942965310270324946613e3,
		0.826249921864842828517165201378329672e3,
		0.83151778002390615664869915512149181e3,
		0.836790779582469903450748647133205842e3,
		0.842068894241700420679793816863008555e3,
		0.847352097970438409186573614192171386e3,
		0.852640365001132944422843280365439743e3,
		0.85793366982585743681825340165730828e3,
		0.863231987192405473495706616688135185e3,
		0.868535292100464549246771933921421434e3,
		0.873843559797865754007073364309792599e3,
		0.879156765776907541339361989085597691e3,
		0.884474885770751757729841233183309696e3,
		0.889797895749890165908308755889573291e3,
		0.895125771918679746988494590326084909e3,
		0.900458490711945116062091833631740156e3,
		0.905796028791646434035814249559138181e3,
		0.911138363043611245039885220568991164e3,
		0.916485470574328713720403810004041234e3,
		0.921837328707804780216145766269495514e3,
		0.927193914982476792669124699651440925e3,
		0.932555207148186217781849399420876484e3,
		0.937921183163208069264571030359357938e3,
		0.943291821191335732062644632205929973e3,
		0.948667099599019897065082064281072079e3,
		0.954046996952560356616116581349057616e3,
		0.959431492015349445625911129922724995e3,
		0.964820563745165946446398484017086063e3,
		0.970214191291518307983895651171193733e3,
		0.975612353993036060800198673230632178e3,
		0.981015031374908340245379246260044328e3,
		0.986422203146368459004015351469767468e3,
		0.99183384919822349885620686482050153e3,
		0.997249949600427918988198873960798957e3,
		0.1002670484599700204866198237575873155e4,
		0.1008095434617181607541211619152706652e4,
		0.1013524780246136048311450356064433384e4,
		0.1018958502249690287959891591668365993e4,
		0.1024396581558613483334716335954860553e4,
		0.1029838999269135276875278877513191388e4,
		0.1035285736640801586830713845909927829e4,
		0.1040736775094367287396016070784596717e4,
		0.1046192096209724988824277280821465263e4,
		0.1051651681723869147785698990824463625e4,
		0.1057115513528894757855149505441099675e4,
		0.1062583573670029889040717696219503612e4,
		0.1068055844343701363735489815702278095e4,
		0.1073532307895632874402452979296540004e4,
		0.1079012946818974865706117912352521423e4,
		0.1084497743752465520701584323671232239e4,
		0.1089986681478622207099125442948620674e4,
		0.1095479742921962755556101669133233303e4,
		0.1100976911147255957423687522479575271e4,
		0.1106478169357800684408498987299687818e4,
		0.1111983500893733047213178228031105928e4,
		0.11174928892303610244092407429045591e4,
		0.1123006317976526006583421603593475987e4,
		0.1128523770872990714198292321053689883e4,
		0.1134045231790852960631511831174826622e4,
		0.1139570684729984744517730416413834876e4,
		0.114510011381749616782446072387403946e4,
		0.1150633503306223688059329420283814785e4,
		0.1156170837573242224641794093212989254e4,
	} ;

	if (pi == 0.L)  pi = m_pi_ld();

	if (n < 0)
		return HUGE_VALL;
	else if (n > 254)
	{
		long double x = n + 1;
		return (x - 0.5)*logl_core(x) - x + 0.5*logl_core(2*pi) + 1.0/(12.0*x);
	}
	else
		return lf[n];
}

#if defined(__cplusplus)
}
#endif

#endif /* GML_LOGFACTRIAL_DBL_INTERNAL */
